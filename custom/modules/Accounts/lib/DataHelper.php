<?phprequire_once('custom/modules/Accounts/lib/libchart/classes/libchart.php');class DataHelper{    public static $account_id;	public static function getData($account_id){		global $db;		$sql = "SELECT *				FROM				(					SELECT YEAR(av_net_worth.net_worth_date) AS year, MONTH(av_net_worth.net_worth_date) AS month, DAY(av_net_worth.net_worth_date) AS day,  av_net_worth.grand_total AS worth, av_net_worth.managed_assets				FROM av_net_worth				WHERE 					av_net_worth.deleted=0 					AND 					av_net_worth.account_id = '{$account_id}'				  ORDER BY av_net_worth.net_worth_date DESC				) AS a1				GROUP BY a1.month, a1.year				ORDER BY a1.year DESC			";					$sql_result = $db->query($sql);		$graph_data_db = array();		$year = 0;		while($graph_data_row = $db->fetchByAssoc($sql_result)){			$graph_data_db[$graph_data_row['year']][$graph_data_row['month']] = array('worth'=>$graph_data_row['worth'],'managed_assets'=>$graph_data_row['managed_assets']);			if($year == 0){					$year = $graph_data_row['year']-5;			}		}		$data4graph = array();		$k=0;		$last_value = 0;		$last_value_managed = 0;		for($j=1; $j<=5; $j++){			$year++;			for($i=1; $i<=12; $i++){				$graph_data_db[$year][$i]['worth'] =(empty($graph_data_db[$year][$i]['worth'])) ? $last_value: $graph_data_db[$year][$i]['worth'];				$graph_data_db[$year][$i]['managed_assets'] =(empty($graph_data_db[$year][$i]['managed_assets'])) ? $last_value_managed : $graph_data_db[$year][$i]['managed_assets'];				$data4graph[$k]['year'] = ($i==1) ? $year : '';				$data4graph[$k]['worth'] = $graph_data_db[$year][$i]['worth'];					$data4graph[$k]['managed_assets'] = $graph_data_db[$year][$i]['managed_assets'];					$k++;				$last_value = $graph_data_db[$year][$i]['worth'];				$last_value_managed = $graph_data_db[$year][$i]['managed_assets'];			}		}		self::$account_id = $account_id;		return $data4graph;	}	public static function getHTML($data4graph){		$html = "";		$dataSet = new XYSeriesDataSet();		$images = array();		$chart = new LineChart(1250, 600);		$chart->setTitle("");		$serie = new XYDataSet();		$serie1 = new XYDataSet();		for($i=0; $i<count($data4graph); $i++){			if(!empty($data4graph[$i]['year'])){				$serie->addPoint(new Point($data4graph[$i]['year'], $data4graph[$i]['worth']));				$serie1->addPoint(new Point($data4graph[$i]['year'], $data4graph[$i]['managed_assets']));			}else{				$serie->addPoint(new Point('', $data4graph[$i]['worth']));				$serie1->addPoint(new Point('', $data4graph[$i]['managed_assets']));			}		}		$dataSet->addSerie('Net Worth', $serie);		$dataSet->addSerie('Managed Assets', $serie1);		$chart->setDataSet($dataSet);		if(!is_dir("cache/images")){			mkdir("cache/images");		}				$img = 'cache/images/clientNetWorthHistory.png';					$chart->render($img);		$images[] = $img;		$account_bean = BeanFactory::getBean('Accounts', self::$account_id);		global $timedate;		$html .= "<div >Client Name: ".$account_bean->name."<br/>Date Generated: ".$timedate->nowDate();		$html .= "</div>";		return $html;	}}